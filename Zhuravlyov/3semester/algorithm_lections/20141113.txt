Продолжаем рассмматривать игры на графах.

Игра бывает проигрышной, выигрышной или ничейной. Будем обозначать это u(A)=-1, 1, 0.
Если есть переход из A в A1, ..., An. По выигрыш достигается, если есть переход в проигрышную ситуацию.
Если есть переход в ничейную ситуацию, то дост. ничья. Иначе - проигрыш.

Игра - это вообще говоря, граф. Справедливой называется игра, в которой оба игрока могут делать одинаковые ходы.
Шахматы, например, несправедливая игра: первый игрок может делать только ходы белыми фигурами, а второй - только чёрными.
Но понятно, что можно сделать игру справеливой: скажем, что все могут делать ходы всеми фигурами, но на нечётном ходу двигать только белые фигуры.

Если у нас есть 2 игры: A и B, то прямая сумма игр представляется на новом графе. 
В нём новое множество вершин - это декартово произедение Va x Vb.
Рёбра: (a,b)->(c,b), если a->c in Ea. (a,b)->(a,c), если b->c in Eb.
Обозначение: A+B.
Неформально: То есть у нас есть 2 графа с двумя фишками, которые стоят в стартовом состоянии. На каждом ходу можно двигать одну из двух фишек.

Назовём 2 игры изморфными, если графы, соответствующие им, изморфны.
Понятно, что игры A+B и B+A изморфны.
Так же, как и игры A+(B+C) и (A+B)+C.
Ну и если у нас X и Y изморфны, то можно заменить X+A+B на Y+A+B.

Игры A и B эквивалентны по гранди, если для любой игры C, u(A+C)=u(B+C). Обозначим: A~B.
При этом классы эквивалентности могут очевидно быть существенно шире, чем при изморфизме.

Лемма о симметричной стратеги:
u(A+A) = -1 для ациклического графа A.

Если A1~A2 и B1~B2 то A1+B1~A2+B2.
Докажем это:
u(A1+B1+C)=u(A1+(B1+C))=u(A2+(B1+C))=u(B1+(A2+C))=u(B2+(A2+C))=u(A2+B2+C)
То есть любую игру можно заменить на эквивалентную ей по Гранди.

Пусть L - проигрышная.
Тогда u(L+C)=u(C)
Пусть C проигрышная. Тогда L+C тоже проигрышная. Второму игроку нужно просто на каждый ход отвечать выигрышной стратегией в соответствующией игре.
Пусть C выигрышная. Первому игроку нужно C перевести в проигрышную игру и мы получим предыдующую ситуаци.
Есть С ничейная. Тогда первый игрок делает ничейный игрок в игре C. Если второй игрок делает ход в игре L, то первый игрок отвечает выигрышной стратегией.
То есть проиграть первый игрок никак не может. На самом деле выигрышной стратегии у него тоже нет.

Если A и B проигрышные, то A~B.
u(A+C)=u(C)=u(B+C)

То есть любая проигрышная игра эквивалентна(по Гранди) игре из одной вершины без рёбер. Можно считать это Нимом из нуля камней. Его будем обозначать *0.
Вообще *i - это ним из i камней.

На самом деле i=j <=> *i~*j
При i!=j: u(*i+*i)=-1, u(*i+*j=1
То есть все нимы попарно-неэквивалентны.

A~*i <=> A+*i~*0
=> A+*i~*i+*i~*0
<= A~A+*0~A+(*i+*i)~(A+*i)+*i~*0+*i~*i

То есть A эквивалентна ниму из i камней <=> A+*i проигрышная.

Теорема Шпрага-Гранди
Если A ациклическая, то A~*i для какого-то i.
Докажем.
Индукция по числу вершин в графе.
База - очевидна.
Пусть есть вершина A и есть переходы в A1..An все эти A1..An эквивалетны некоторым нимам по предположениям индукции.
Введём обозначение: A~*i <=> g(A)=i
Утверждается, то g(A)=mex{g(A1), ..., g(An)}
mex(minimal exluded) - наименьшее число с нуля, которое не входит в это множество.
mex{0,3,1,5,4,8}=2.
Нужно показать, что *g(A) эквивалетна игре A, то есть *g(A)+A проигрышная.
Если первый игрок ходит в игре A, то у нас есть ним из двух одинаковых кучек.
Если был ход в *g(A), то отвечаем симметричным ходом в A.
Всё из-за того, что g(A) - это именно minimal excluded.

Утверждается, что
*i+*j~*(i^j)
Индукция по i+j.
база *0+*0~*0
Переходы
(i,j)->(k,j) k<i, (i,j)->(i,k) k<j.
Чему же равен mex{k^j, k<i; i^k, k<j}
Пусть k^j=i^j тогда k=i
То есть i^j в нашем множестве не лежит. Но нет ли чисел меньше, которые не лежат в нём.
Если есть какое-то z такое, что меньше, чем i^j, то рассмаривая первый бит в котором они различаются, придём к противоречию.

Таким образом мы умеем исследовать все игры на ациклических графах: находить ним, которому она эквивалентна за линейное время по чилу рёбер.
По прямой сумме игр нескольких игр определять ним, которому она эквивалентна.

